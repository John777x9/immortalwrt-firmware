#!/bin/bash
# ============================================
# x86/64 软路由 — 适用于 PVE/ESXi/物理机
# ============================================

REPO="https://github.com/immortalwrt/immortalwrt.git"
BRANCH="master"

TARGET="x86"
SUBTARGET="64"
DEVICE=""

ROOTFS_PARTSIZE=1024
EFI="yes"

DESCRIPTION="x86/64 软路由固件 - 适用于 PVE / ESXi / 物理软路由"

PACKAGES=(
    # --- 代理 ---
    +luci-app-homeproxy
    +luci-app-passwall

    # --- 主题 ---
    +luci-theme-argon
    +luci-app-argon-config

    # --- 系统工具 ---
    +luci-app-ttyd
    +luci-app-ddns-go
    +luci-app-netdata
    +luci-app-frpc
    +luci-app-upnp
    +luci-app-acl

    # --- 网络诊断 ---
    +tcpdump
    +bind-dig
    +curl
    +wget-ssl
    +ip-full
    +iperf3

    # --- 透明代理内核模块 ---
    +kmod-nft-tproxy
    +kmod-nft-socket
    +kmod-nft-fullcone
    +kmod-tun
    +kmod-inet-diag
    +sing-box

    # --- 磁盘/存储 ---
    +block-mount
    +kmod-fs-ext4
    +kmod-fs-ntfs3
    +kmod-fs-vfat
    +fdisk
    +lsblk

    # --- 虚拟化驱动（x86专用）---
    +kmod-e1000e
    +kmod-igb
    +kmod-igc
    +kmod-r8169
    +kmod-vmxnet3
    +kmod-virtio-net
    +kmod-pcnet32
    +qemu-ga

    # --- 去掉 ---
    -luci-app-rclone
    -luci-app-banip
    -luci-app-ramfree
    -luci-app-samba4
)

LANG="zh-cn"
SINGBOX_FEATURES=(ACME ECH GVISOR QUIC REALITY_SERVER UTLS WIREGUARD)
PASSWALL_INCLUDE=(Haproxy Shadowsocks_Rust_Client Shadowsocks_Rust_Server Simple_Obfs SingBox V2ray_Geoview V2ray_Plugin Xray)
